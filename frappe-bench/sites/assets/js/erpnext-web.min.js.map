{"version":3,"file":"erpnext-web.min.js","sources":["../../../apps/erpnext/erpnext/public/js/website_utils.js","../../../apps/erpnext/erpnext/public/js/shopping_cart.js"],"sourcesContent":["// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nif(!window.erpnext) window.erpnext = {};\n\n// Add / update a new Lead / Communication\n// subject, sender, description\nfrappe.send_message = function(opts, btn) {\n\treturn frappe.call({\n\t\ttype: \"POST\",\n\t\tmethod: \"erpnext.templates.utils.send_message\",\n\t\tbtn: btn,\n\t\targs: opts,\n\t\tcallback: opts.callback\n\t});\n};\n\nerpnext.subscribe_to_newsletter = function(opts, btn) {\n\treturn frappe.call({\n\t\ttype: \"POST\",\n\t\tmethod: \"frappe.email.doctype.newsletter.newsletter.subscribe\",\n\t\tbtn: btn,\n\t\targs: {\"email\": opts.email},\n\t\tcallback: opts.callback\n\t});\n}\n\n// for backward compatibility\nerpnext.send_message = frappe.send_message;\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\n// shopping cart\nfrappe.provide(\"erpnext.shopping_cart\");\nvar shopping_cart = erpnext.shopping_cart;\n\nfrappe.ready(function() {\n\tvar full_name = frappe.session && frappe.session.user_fullname;\n\t// update user\n\tif(full_name) {\n\t\t$('.navbar li[data-label=\"User\"] a')\n\t\t\t.html('<i class=\"fa fa-fixed-width fa fa-user\"></i> ' + full_name);\n\t}\n\n\t// update login\n\tshopping_cart.show_shoppingcart_dropdown();\n\tshopping_cart.set_cart_count();\n\tshopping_cart.bind_dropdown_cart_buttons();\n});\n\n$.extend(shopping_cart, {\n\tshow_shoppingcart_dropdown: function() {\n\t\t$(\".shopping-cart\").on('shown.bs.dropdown', function() {\n\t\t\tif (!$('.shopping-cart-menu .cart-container').length) {\n\t\t\t\treturn frappe.call({\n\t\t\t\t\tmethod: 'erpnext.shopping_cart.cart.get_shopping_cart_menu',\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\t$('.shopping-cart-menu').html(r.message);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tupdate_cart: function(opts) {\n\t\tif(frappe.session.user===\"Guest\") {\n\t\t\tif(localStorage) {\n\t\t\t\tlocalStorage.setItem(\"last_visited\", window.location.pathname);\n\t\t\t}\n\t\t\twindow.location.href = \"/login\";\n\t\t} else {\n\t\t\treturn frappe.call({\n\t\t\t\ttype: \"POST\",\n\t\t\t\tmethod: \"erpnext.shopping_cart.cart.update_cart\",\n\t\t\t\targs: {\n\t\t\t\t\titem_code: opts.item_code,\n\t\t\t\t\tqty: opts.qty,\n\t\t\t\t\tadditional_notes: opts.additional_notes !== undefined ? opts.additional_notes : undefined,\n\t\t\t\t\twith_items: opts.with_items || 0\n\t\t\t\t},\n\t\t\t\tbtn: opts.btn,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tshopping_cart.set_cart_count();\n\t\t\t\t\tif (r.message.shopping_cart_menu) {\n\t\t\t\t\t\t$('.shopping-cart-menu').html(r.message.shopping_cart_menu);\n\t\t\t\t\t}\n\t\t\t\t\tif(opts.callback)\n\t\t\t\t\t\topts.callback(r);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tset_cart_count: function() {\n\t\tvar cart_count = frappe.get_cookie(\"cart_count\");\n\t\tif(frappe.session.user===\"Guest\") {\n\t\t\tcart_count = 0;\n\t\t}\n\n\t\tif(cart_count) {\n\t\t\t$(\".shopping-cart\").toggleClass('hidden', false);\n\t\t}\n\n\t\tvar $cart = $('.cart-icon');\n\t\tvar $badge = $cart.find(\"#cart-count\");\n\n\t\tif(parseInt(cart_count) === 0 || cart_count === undefined) {\n\t\t\t$cart.css(\"display\", \"none\");\n\t\t\t$(\".cart-items\").html('Cart is Empty');\n\t\t\t$(\".cart-tax-items\").hide();\n\t\t\t$(\".btn-place-order\").hide();\n\t\t\t$(\".cart-addresses\").hide();\n\t\t}\n\t\telse {\n\t\t\t$cart.css(\"display\", \"inline\");\n\t\t}\n\n\t\tif(cart_count) {\n\t\t\t$badge.html(cart_count);\n\t\t} else {\n\t\t\t$badge.remove();\n\t\t}\n\t},\n\n\tshopping_cart_update: function({item_code, qty, cart_dropdown, additional_notes}) {\n\t\tfrappe.freeze();\n\t\tshopping_cart.update_cart({\n\t\t\titem_code,\n\t\t\tqty,\n\t\t\tadditional_notes,\n\t\t\twith_items: 1,\n\t\t\tbtn: this,\n\t\t\tcallback: function(r) {\n\t\t\t\tfrappe.unfreeze();\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\t$(\".cart-items\").html(r.message.items);\n\t\t\t\t\t$(\".cart-tax-items\").html(r.message.taxes);\n\t\t\t\t\tif (cart_dropdown != true) {\n\t\t\t\t\t\t$(\".cart-icon\").hide();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t},\n\n\n\tbind_dropdown_cart_buttons: function () {\n\t\t$(\".cart-icon\").on('click', '.number-spinner button', function () {\n\t\t\tvar btn = $(this),\n\t\t\t\tinput = btn.closest('.number-spinner').find('input'),\n\t\t\t\toldValue = input.val().trim(),\n\t\t\t\tnewVal = 0;\n\n\t\t\tif (btn.attr('data-dir') == 'up') {\n\t\t\t\tnewVal = parseInt(oldValue) + 1;\n\t\t\t} else {\n\t\t\t\tif (oldValue > 1) {\n\t\t\t\t\tnewVal = parseInt(oldValue) - 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\tinput.val(newVal);\n\t\t\tvar item_code = input.attr(\"data-item-code\");\n\t\t\tshopping_cart.shopping_cart_update({item_code, qty: newVal, cart_dropdown: true});\n\t\t\treturn false;\n\t\t});\n\n\t},\n\n});\n"],"names":["window","erpnext","frappe","send_message","opts","btn","call","type","method","args","callback","subscribe_to_newsletter","email","provide","shopping_cart","ready","full_name","session","user_fullname","$","html","show_shoppingcart_dropdown","set_cart_count","bind_dropdown_cart_buttons","extend","on","length","r","message","update_cart","user","item_code","qty","additional_notes","undefined","with_items","shopping_cart_menu","localStorage","setItem","location","pathname","href","cart_count","get_cookie","toggleClass","$cart","$badge","find","parseInt","css","hide","remove","shopping_cart_update","ref","freeze","this","unfreeze","exc","items","taxes","cart_dropdown","input","closest","oldValue","val","trim","newVal","attr"],"mappings":"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"}